
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>services: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">classsphere-backend/services/google.go (85.4%)</option>
				
				<option value="file1">classsphere-backend/services/metrics.go (93.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package services

import (
        "fmt"
        "math/rand"
        "time"
)

// GoogleClient interface for dependency injection
type GoogleClient interface {
        ListCourses(userID string) ([]Course, error)
        ListStudents(courseID string) ([]Student, error)
        ListAssignments(courseID string) ([]Assignment, error)
}

// Course represents a Google Classroom course
type Course struct {
        ID          string `json:"id"`
        Name        string `json:"name"`
        Description string `json:"description"`
        Section     string `json:"section"`
        Room        string `json:"room"`
        OwnerID     string `json:"ownerId"`
        CourseState string `json:"courseState"`
}

// Student represents a Google Classroom student
type Student struct {
        ID       string `json:"id"`
        Name     string `json:"name"`
        Email    string `json:"email"`
        PhotoURL string `json:"photoUrl"`
}

// Assignment represents a Google Classroom assignment
type Assignment struct {
        ID          string `json:"id"`
        Title       string `json:"title"`
        Description string `json:"description"`
        DueDate     string `json:"dueDate"`
        MaxPoints   int    `json:"maxPoints"`
        State       string `json:"state"`
}

// GoogleClassroomService handles Google Classroom API integration
type GoogleClassroomService struct {
        client   GoogleClient
        mockMode bool
}

// NewGoogleClassroomService creates a new Google Classroom service
func NewGoogleClassroomService(client GoogleClient) *GoogleClassroomService <span class="cov8" title="1">{
        return &amp;GoogleClassroomService{
                client:   client,
                mockMode: false,
        }
}</span>

// SetMockMode enables or disables mock mode
func (s *GoogleClassroomService) SetMockMode(enabled bool) <span class="cov8" title="1">{
        s.mockMode = enabled
}</span>

// ListCourses retrieves courses for a user
func (s *GoogleClassroomService) ListCourses(userID string) ([]Course, error) <span class="cov8" title="1">{
        if s.mockMode </span><span class="cov8" title="1">{
                return s.getMockCourses(), nil
        }</span>

        <span class="cov8" title="1">if s.client == nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("Google client not initialized")
        }</span>

        <span class="cov8" title="1">return s.client.ListCourses(userID)</span>
}

// ListStudents retrieves students for a course
func (s *GoogleClassroomService) ListStudents(courseID string) ([]Student, error) <span class="cov8" title="1">{
        if s.mockMode </span><span class="cov8" title="1">{
                return s.getMockStudents(), nil
        }</span>

        <span class="cov8" title="1">if s.client == nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("Google client not initialized")
        }</span>

        <span class="cov8" title="1">return s.client.ListStudents(courseID)</span>
}

// ListAssignments retrieves assignments for a course
func (s *GoogleClassroomService) ListAssignments(courseID string) ([]Assignment, error) <span class="cov8" title="1">{
        if s.mockMode </span><span class="cov8" title="1">{
                return s.getMockAssignments(), nil
        }</span>

        <span class="cov8" title="1">if s.client == nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("Google client not initialized")
        }</span>

        <span class="cov8" title="1">return s.client.ListAssignments(courseID)</span>
}

// getMockCourses returns mock course data for testing and development
func (s *GoogleClassroomService) getMockCourses() []Course <span class="cov8" title="1">{
        return []Course{
                {
                        ID:          "course_mock_1",
                        Name:        "Advanced Mathematics",
                        Description: "Comprehensive study of calculus, algebra, and geometry",
                        Section:     "A",
                        Room:        "Room 201",
                        OwnerID:     "teacher_mock_1",
                        CourseState: "ACTIVE",
                },
                {
                        ID:          "course_mock_2",
                        Name:        "Physics Laboratory",
                        Description: "Hands-on experiments in mechanics, thermodynamics, and electromagnetism",
                        Section:     "B",
                        Room:        "Lab 301",
                        OwnerID:     "teacher_mock_2",
                        CourseState: "ACTIVE",
                },
                {
                        ID:          "course_mock_3",
                        Name:        "English Literature",
                        Description: "Study of classic and contemporary literature",
                        Section:     "C",
                        Room:        "Room 105",
                        OwnerID:     "teacher_mock_3",
                        CourseState: "ACTIVE",
                },
                {
                        ID:          "course_mock_4",
                        Name:        "Computer Science",
                        Description: "Programming fundamentals and software engineering",
                        Section:     "D",
                        Room:        "Computer Lab 1",
                        OwnerID:     "teacher_mock_4",
                        CourseState: "ACTIVE",
                },
                {
                        ID:          "course_mock_5",
                        Name:        "World History",
                        Description: "Comprehensive study of world civilizations and events",
                        Section:     "E",
                        Room:        "Room 208",
                        OwnerID:     "teacher_mock_5",
                        CourseState: "ACTIVE",
                },
        }
}</span>

// getMockStudents returns mock student data for testing and development
func (s *GoogleClassroomService) getMockStudents() []Student <span class="cov8" title="1">{
        return []Student{
                {
                        ID:       "student_mock_1",
                        Name:     "Alice Johnson",
                        Email:    "alice.johnson@classsphere.edu",
                        PhotoURL: "https://example.com/photos/alice.jpg",
                },
                {
                        ID:       "student_mock_2",
                        Name:     "Bob Smith",
                        Email:    "bob.smith@classsphere.edu",
                        PhotoURL: "https://example.com/photos/bob.jpg",
                },
                {
                        ID:       "student_mock_3",
                        Name:     "Carol Davis",
                        Email:    "carol.davis@classsphere.edu",
                        PhotoURL: "https://example.com/photos/carol.jpg",
                },
                {
                        ID:       "student_mock_4",
                        Name:     "David Wilson",
                        Email:    "david.wilson@classsphere.edu",
                        PhotoURL: "https://example.com/photos/david.jpg",
                },
                {
                        ID:       "student_mock_5",
                        Name:     "Eva Brown",
                        Email:    "eva.brown@classsphere.edu",
                        PhotoURL: "https://example.com/photos/eva.jpg",
                },
                {
                        ID:       "student_mock_6",
                        Name:     "Frank Miller",
                        Email:    "frank.miller@classsphere.edu",
                        PhotoURL: "https://example.com/photos/frank.jpg",
                },
                {
                        ID:       "student_mock_7",
                        Name:     "Grace Lee",
                        Email:    "grace.lee@classsphere.edu",
                        PhotoURL: "https://example.com/photos/grace.jpg",
                },
                {
                        ID:       "student_mock_8",
                        Name:     "Henry Taylor",
                        Email:    "henry.taylor@classsphere.edu",
                        PhotoURL: "https://example.com/photos/henry.jpg",
                },
        }
}</span>

// getMockAssignments returns mock assignment data for testing and development
func (s *GoogleClassroomService) getMockAssignments() []Assignment <span class="cov8" title="1">{
        now := time.Now()
        
        return []Assignment{
                {
                        ID:          "assignment_mock_1",
                        Title:       "Calculus Problem Set 1",
                        Description: "Solve differential equations and integration problems",
                        DueDate:     now.AddDate(0, 0, 7).Format("2006-01-02"),
                        MaxPoints:   100,
                        State:       "PUBLISHED",
                },
                {
                        ID:          "assignment_mock_2",
                        Title:       "Physics Lab Report: Pendulum Motion",
                        Description: "Write a comprehensive report on pendulum motion experiments",
                        DueDate:     now.AddDate(0, 0, 5).Format("2006-01-02"),
                        MaxPoints:   150,
                        State:       "PUBLISHED",
                },
                {
                        ID:          "assignment_mock_3",
                        Title:       "Literature Analysis: Shakespeare's Hamlet",
                        Description: "Analyze themes and character development in Hamlet",
                        DueDate:     now.AddDate(0, 0, 10).Format("2006-01-02"),
                        MaxPoints:   120,
                        State:       "PUBLISHED",
                },
                {
                        ID:          "assignment_mock_4",
                        Title:       "Programming Project: Web Application",
                        Description: "Build a full-stack web application using modern technologies",
                        DueDate:     now.AddDate(0, 0, 14).Format("2006-01-02"),
                        MaxPoints:   200,
                        State:       "PUBLISHED",
                },
                {
                        ID:          "assignment_mock_5",
                        Title:       "History Research Paper: World War II",
                        Description: "Research and analyze the causes and effects of World War II",
                        DueDate:     now.AddDate(0, 0, 12).Format("2006-01-02"),
                        MaxPoints:   180,
                        State:       "PUBLISHED",
                },
                {
                        ID:          "assignment_mock_6",
                        Title:       "Algebra Quiz: Linear Equations",
                        Description: "Quiz covering solving linear equations and graphing",
                        DueDate:     now.AddDate(0, 0, 3).Format("2006-01-02"),
                        MaxPoints:   80,
                        State:       "PUBLISHED",
                },
        }
}</span>

// GetRandomCourse returns a random course from mock data
func (s *GoogleClassroomService) GetRandomCourse() Course <span class="cov8" title="1">{
        courses := s.getMockCourses()
        if len(courses) == 0 </span><span class="cov0" title="0">{
                return Course{}
        }</span>
        
        <span class="cov8" title="1">rand.Seed(time.Now().UnixNano())
        return courses[rand.Intn(len(courses))]</span>
}

// GetRandomStudent returns a random student from mock data
func (s *GoogleClassroomService) GetRandomStudent() Student <span class="cov8" title="1">{
        students := s.getMockStudents()
        if len(students) == 0 </span><span class="cov0" title="0">{
                return Student{}
        }</span>
        
        <span class="cov8" title="1">rand.Seed(time.Now().UnixNano())
        return students[rand.Intn(len(students))]</span>
}

// GetRandomAssignment returns a random assignment from mock data
func (s *GoogleClassroomService) GetRandomAssignment() Assignment <span class="cov8" title="1">{
        assignments := s.getMockAssignments()
        if len(assignments) == 0 </span><span class="cov0" title="0">{
                return Assignment{}
        }</span>
        
        <span class="cov8" title="1">rand.Seed(time.Now().UnixNano())
        return assignments[rand.Intn(len(assignments))]</span>
}

// GetCourseStats returns statistics for a course
func (s *GoogleClassroomService) GetCourseStats(courseID string) (map[string]interface{}, error) <span class="cov8" title="1">{
        // Get students for the course
        students, err := s.ListStudents(courseID)
        if err != nil </span><span class="cov8" title="1">{
                return nil, fmt.Errorf("failed to get students: %v", err)
        }</span>

        // Get assignments for the course
        <span class="cov8" title="1">assignments, err := s.ListAssignments(courseID)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("failed to get assignments: %v", err)
        }</span>

        // Calculate statistics
        <span class="cov8" title="1">stats := map[string]interface{}{
                "course_id":           courseID,
                "total_students":      len(students),
                "total_assignments":   len(assignments),
                "published_assignments": 0,
                "draft_assignments":   0,
        }

        // Count assignment states
        for _, assignment := range assignments </span><span class="cov8" title="1">{
                if assignment.State == "PUBLISHED" </span><span class="cov8" title="1">{
                        stats["published_assignments"] = stats["published_assignments"].(int) + 1
                }</span> else<span class="cov8" title="1"> {
                        stats["draft_assignments"] = stats["draft_assignments"].(int) + 1
                }</span>
        }

        <span class="cov8" title="1">return stats, nil</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package services

import (
        "math"
)

// MetricsService handles calculation of educational metrics
type MetricsService struct{}

// NewMetricsService creates a new metrics service
func NewMetricsService() *MetricsService <span class="cov8" title="1">{
        return &amp;MetricsService{}
}</span>

// CourseMetrics represents metrics for courses
type CourseMetrics struct {
        TotalCourses      int     `json:"total_courses"`
        ActiveCourses     int     `json:"active_courses"`
        ArchivedCourses   int     `json:"archived_courses"`
        TotalStudents     int     `json:"total_students"`
        AverageGrade      float64 `json:"average_grade"`
        TotalAssignments  int     `json:"total_assignments"`
}

// StudentMetrics represents metrics for students
type StudentMetrics struct {
        TotalStudents   int `json:"total_students"`
        ActiveStudents  int `json:"active_students"`
}

// AssignmentMetrics represents metrics for assignments
type AssignmentMetrics struct {
        TotalAssignments      int     `json:"total_assignments"`
        PublishedAssignments  int     `json:"published_assignments"`
        DraftAssignments      int     `json:"draft_assignments"`
        TotalPoints           int     `json:"total_points"`
        AveragePoints         float64 `json:"average_points"`
}

// DashboardMetrics represents combined dashboard metrics
type DashboardMetrics struct {
        Courses     CourseMetrics     `json:"courses"`
        Students    StudentMetrics    `json:"students"`
        Assignments AssignmentMetrics `json:"assignments"`
}

// CalculateCourseMetrics calculates metrics for a list of courses
func (s *MetricsService) CalculateCourseMetrics(courses []Course) CourseMetrics <span class="cov8" title="1">{
        metrics := CourseMetrics{}

        if len(courses) == 0 </span><span class="cov8" title="1">{
                return metrics
        }</span>

        <span class="cov8" title="1">metrics.TotalCourses = len(courses)
        
        // Count active and archived courses
        for _, course := range courses </span><span class="cov8" title="1">{
                if course.CourseState == "ACTIVE" </span><span class="cov8" title="1">{
                        metrics.ActiveCourses++
                }</span> else<span class="cov8" title="1"> if course.CourseState == "ARCHIVED" </span><span class="cov8" title="1">{
                        metrics.ArchivedCourses++
                }</span>
        }

        // For active courses, calculate total students and assignments
        // Using mock data: 8 students per course, 6 assignments per course
        <span class="cov8" title="1">metrics.TotalStudents = metrics.ActiveCourses * 8
        metrics.TotalAssignments = metrics.ActiveCourses * 6
        
        // Mock average grade
        metrics.AverageGrade = 85.5

        return metrics</span>
}

// CalculateStudentMetrics calculates metrics for a list of students
func (s *MetricsService) CalculateStudentMetrics(students []Student) StudentMetrics <span class="cov8" title="1">{
        metrics := StudentMetrics{}

        if len(students) == 0 </span><span class="cov8" title="1">{
                return metrics
        }</span>

        <span class="cov8" title="1">metrics.TotalStudents = len(students)
        metrics.ActiveStudents = len(students) // All students are considered active in mock data

        return metrics</span>
}

// CalculateAssignmentMetrics calculates metrics for a list of assignments
func (s *MetricsService) CalculateAssignmentMetrics(assignments []Assignment) AssignmentMetrics <span class="cov8" title="1">{
        metrics := AssignmentMetrics{}

        if len(assignments) == 0 </span><span class="cov8" title="1">{
                return metrics
        }</span>

        <span class="cov8" title="1">metrics.TotalAssignments = len(assignments)
        
        totalPoints := 0
        
        // Count published and draft assignments, calculate total points
        for _, assignment := range assignments </span><span class="cov8" title="1">{
                if assignment.State == "PUBLISHED" </span><span class="cov8" title="1">{
                        metrics.PublishedAssignments++
                }</span> else<span class="cov8" title="1"> if assignment.State == "DRAFT" </span><span class="cov8" title="1">{
                        metrics.DraftAssignments++
                }</span>
                
                <span class="cov8" title="1">totalPoints += assignment.MaxPoints</span>
        }

        <span class="cov8" title="1">metrics.TotalPoints = totalPoints
        
        // Calculate average points
        if metrics.TotalAssignments &gt; 0 </span><span class="cov8" title="1">{
                metrics.AveragePoints = math.Round(float64(totalPoints)/float64(metrics.TotalAssignments)*100) / 100
        }</span>

        <span class="cov8" title="1">return metrics</span>
}

// GetDashboardMetrics calculates combined dashboard metrics
func (s *MetricsService) GetDashboardMetrics(courses []Course, students []Student, assignments []Assignment) DashboardMetrics <span class="cov8" title="1">{
        return DashboardMetrics{
                Courses:     s.CalculateCourseMetrics(courses),
                Students:    s.CalculateStudentMetrics(students),
                Assignments: s.CalculateAssignmentMetrics(assignments),
        }
}</span>

// GetRoleSpecificMetrics calculates metrics specific to user roles
func (s *MetricsService) GetRoleSpecificMetrics(role string, courses []Course, students []Student, assignments []Assignment) map[string]interface{} <span class="cov8" title="1">{
        baseMetrics := s.GetDashboardMetrics(courses, students, assignments)
        
        roleMetrics := map[string]interface{}{
                "role":     role,
                "base":     baseMetrics,
                "specific": map[string]interface{}{},
        }

        switch role </span>{
        case "student":<span class="cov8" title="1">
                roleMetrics["specific"] = map[string]interface{}{
                        "my_courses":        len(courses),
                        "pending_assignments": s.countPendingAssignments(assignments),
                        "completed_assignments": s.countCompletedAssignments(assignments),
                        "average_grade":     baseMetrics.Courses.AverageGrade,
                }</span>
        case "teacher":<span class="cov8" title="1">
                roleMetrics["specific"] = map[string]interface{}{
                        "my_courses":        len(courses),
                        "total_students":    baseMetrics.Students.TotalStudents,
                        "graded_assignments": s.countGradedAssignments(assignments),
                        "pending_grades":    s.countPendingGrades(assignments),
                }</span>
        case "coordinator":<span class="cov8" title="1">
                roleMetrics["specific"] = map[string]interface{}{
                        "total_courses":     baseMetrics.Courses.TotalCourses,
                        "total_teachers":    s.estimateTeachers(courses),
                        "total_students":    baseMetrics.Students.TotalStudents,
                        "active_programs":   s.countActivePrograms(courses),
                }</span>
        case "admin":<span class="cov8" title="1">
                roleMetrics["specific"] = map[string]interface{}{
                        "total_users":       baseMetrics.Students.TotalStudents + s.estimateTeachers(courses),
                        "total_courses":     baseMetrics.Courses.TotalCourses,
                        "system_health":     "healthy",
                        "uptime_percentage": 99.9,
                }</span>
        }

        <span class="cov8" title="1">return roleMetrics</span>
}

// Helper methods for role-specific calculations

func (s *MetricsService) countPendingAssignments(assignments []Assignment) int <span class="cov8" title="1">{
        // Mock implementation: assume 30% of assignments are pending
        return int(math.Ceil(float64(len(assignments)) * 0.3))
}</span>

func (s *MetricsService) countCompletedAssignments(assignments []Assignment) int <span class="cov8" title="1">{
        // Mock implementation: assume 70% of assignments are completed
        return int(math.Floor(float64(len(assignments)) * 0.7))
}</span>

func (s *MetricsService) countGradedAssignments(assignments []Assignment) int <span class="cov8" title="1">{
        // Mock implementation: assume 60% of assignments are graded
        return int(math.Floor(float64(len(assignments)) * 0.6))
}</span>

func (s *MetricsService) countPendingGrades(assignments []Assignment) int <span class="cov8" title="1">{
        // Mock implementation: assume 40% of assignments are pending grades
        return int(math.Ceil(float64(len(assignments)) * 0.4))
}</span>

func (s *MetricsService) estimateTeachers(courses []Course) int <span class="cov8" title="1">{
        // Mock implementation: assume each teacher handles 2 courses on average
        if len(courses) == 0 </span><span class="cov0" title="0">{
                return 0
        }</span>
        <span class="cov8" title="1">return int(math.Ceil(float64(len(courses)) / 2.0))</span>
}

func (s *MetricsService) countActivePrograms(courses []Course) int <span class="cov8" title="1">{
        // Mock implementation: assume 3 active programs
        return 3
}</span>

// GetPerformanceMetrics calculates performance-related metrics
func (s *MetricsService) GetPerformanceMetrics(courses []Course, students []Student, assignments []Assignment) map[string]interface{} <span class="cov8" title="1">{
        return map[string]interface{}{
                "completion_rate":     s.calculateCompletionRate(assignments),
                "average_grade":       s.calculateAverageGrade(),
                "engagement_score":    s.calculateEngagementScore(courses, students),
                "productivity_index":  s.calculateProductivityIndex(assignments),
                "trends": map[string]interface{}{
                        "grade_trend":      "increasing",
                        "participation":    "stable",
                        "completion_rate":  "improving",
                },
        }
}</span>

func (s *MetricsService) calculateCompletionRate(assignments []Assignment) float64 <span class="cov8" title="1">{
        // Mock implementation: 85% completion rate
        return 85.0
}</span>

func (s *MetricsService) calculateAverageGrade() float64 <span class="cov8" title="1">{
        // Mock implementation: average grade of 85.5
        return 85.5
}</span>

func (s *MetricsService) calculateEngagementScore(courses []Course, students []Student) float64 <span class="cov8" title="1">{
        // Mock implementation: engagement score based on course and student count
        if len(courses) == 0 || len(students) == 0 </span><span class="cov0" title="0">{
                return 0.0
        }</span>
        
        // Simple calculation: engagement = (courses * students) / 100
        <span class="cov8" title="1">engagement := float64(len(courses) * len(students)) / 100.0
        
        // Cap at 100
        if engagement &gt; 100.0 </span><span class="cov0" title="0">{
                engagement = 100.0
        }</span>
        
        <span class="cov8" title="1">return math.Round(engagement*100) / 100</span>
}

func (s *MetricsService) calculateProductivityIndex(assignments []Assignment) float64 <span class="cov8" title="1">{
        // Mock implementation: productivity based on assignment count and points
        if len(assignments) == 0 </span><span class="cov0" title="0">{
                return 0.0
        }</span>
        
        <span class="cov8" title="1">totalPoints := 0
        for _, assignment := range assignments </span><span class="cov8" title="1">{
                totalPoints += assignment.MaxPoints
        }</span>
        
        // Simple calculation: productivity = (assignments * avg_points) / 10
        <span class="cov8" title="1">avgPoints := float64(totalPoints) / float64(len(assignments))
        productivity := float64(len(assignments)) * avgPoints / 10.0
        
        // Cap at 100
        if productivity &gt; 100.0 </span><span class="cov0" title="0">{
                productivity = 100.0
        }</span>
        
        <span class="cov8" title="1">return math.Round(productivity*100) / 100</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
